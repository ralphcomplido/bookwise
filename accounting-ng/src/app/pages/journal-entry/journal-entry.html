<div style="max-width:900px;margin:40px auto;font-family:Arial;">
  <h2>Journal Entry</h2>

  <div style="border:1px solid #ddd;padding:14px;border-radius:8px;">
    <div style="display:flex;gap:14px;flex-wrap:wrap;margin-bottom:12px;">
      <div>
        <label>Date</label><br />
        <input type="date" [(ngModel)]="occurredOn" [disabled]="isSubmitting" />
      </div>

      <div style="flex:1;min-width:260px;">
        <label>Description</label><br />
        <input style="width:100%;" type="text" [(ngModel)]="description" [disabled]="isSubmitting" />
      </div>

      <div>
        <label>Reference No</label><br />
        <input type="text" [(ngModel)]="referenceNo" [disabled]="isSubmitting" />
      </div>
    </div>

    <div *ngIf="isLoadingAccounts" style="color:#555;margin:8px 0;">Loading accounts...</div>

    <table style="width:100%;border-collapse:collapse;margin-top:10px;">
      <thead>
        <tr>
          <th style="text-align:left;border-bottom:1px solid #ddd;padding:8px;">Account</th>
          <th style="text-align:right;border-bottom:1px solid #ddd;padding:8px;width:140px;">Debit</th>
          <th style="text-align:right;border-bottom:1px solid #ddd;padding:8px;width:140px;">Credit</th>
          <th style="text-align:left;border-bottom:1px solid #ddd;padding:8px;">Memo</th>
          <th style="border-bottom:1px solid #ddd;padding:8px;width:70px;"></th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let line of lines; let i = index">
          <td style="padding:8px;border-bottom:1px solid #f0f0f0;">
            <select [(ngModel)]="line.accountId" [disabled]="isSubmitting || isLoadingAccounts" style="width:100%;">
              <option [ngValue]="null">-- Select account --</option>
              <option *ngFor="let a of accounts" [ngValue]="a.id">
                {{ a.accountCode }} - {{ a.name }} ({{ typeLabel(a.type) }})
              </option>
            </select>
          </td>

          <td style="padding:8px;border-bottom:1px solid #f0f0f0;text-align:right;">
            <input
              type="number"
              step="0.01"
              style="width:120px;text-align:right;"
              [(ngModel)]="line.debit"
              (ngModelChange)="onDebitChange(line)"
              [disabled]="isSubmitting" />
          </td>

          <td style="padding:8px;border-bottom:1px solid #f0f0f0;text-align:right;">
            <input
              type="number"
              step="0.01"
              style="width:120px;text-align:right;"
              [(ngModel)]="line.credit"
              (ngModelChange)="onCreditChange(line)"
              [disabled]="isSubmitting" />
          </td>

          <td style="padding:8px;border-bottom:1px solid #f0f0f0;">
            <input style="width:100%;" type="text" [(ngModel)]="line.memo" [disabled]="isSubmitting" />
          </td>

          <td style="padding:8px;border-bottom:1px solid #f0f0f0;text-align:center;">
            <button (click)="removeLine(i)" [disabled]="isSubmitting || lines.length <= 2">
              Remove
            </button>
          </td>
        </tr>
      </tbody>

      <tfoot>
        <tr>
          <td style="padding:8px;text-align:right;font-weight:bold;">Totals:</td>
          <td style="padding:8px;text-align:right;font-weight:bold;">
            {{ totalDebit() | number:'1.2-2' }}
          </td>
          <td style="padding:8px;text-align:right;font-weight:bold;">
            {{ totalCredit() | number:'1.2-2' }}
          </td>
          <td style="padding:8px;" colspan="2">
            <span *ngIf="isBalanced()" style="color:green;font-weight:bold;">Balanced</span>
            <span *ngIf="!isBalanced()" style="color:#b45309;font-weight:bold;">Not Balanced</span>
          </td>
        </tr>
      </tfoot>
    </table>

    <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
      <button (click)="addLine()" [disabled]="isSubmitting">Add Line</button>

      <button (click)="submit()" [disabled]="isSubmitting || isLoadingAccounts || !isBalanced()">
        {{ isSubmitting ? 'Saving...' : 'Save Journal Entry' }}
      </button>

      <button (click)="cancel()" [disabled]="isSubmitting">Cancel</button>
    </div>

    <p style="color:red;margin-top:10px;" *ngIf="error">{{ error }}</p>
  </div>
</div>
