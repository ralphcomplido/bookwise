<div class="container">
  <div class="row-between" style="margin-bottom:14px;">
    <div>
      <h2 style="margin:0;">BookWise</h2>
      <div class="muted">Journal Entry</div>
    </div>

    <button class="btn btn-secondary" (click)="cancel()" [disabled]="isSubmitting">
      Back
    </button>
  </div>

  <div class="card">
    <div class="row" style="margin-bottom:12px;">
      <div>
        <label>Date</label><br />
        <input type="date" [(ngModel)]="occurredOn" [disabled]="isSubmitting" />
      </div>

      <div style="flex:1;min-width:260px;">
        <label>Description</label><br />
        <input class="input-full" type="text" [(ngModel)]="description" [disabled]="isSubmitting" />
      </div>

      <div>
        <label>Reference No</label><br />
        <input type="text" [(ngModel)]="referenceNo" [disabled]="isSubmitting" />
      </div>
    </div>

    <div class="muted" *ngIf="isLoadingAccounts" style="margin:8px 0;">Loading accounts...</div>

    <table class="table" style="margin-top:10px;">
      <thead>
        <tr>
          <th>Account</th>
          <th class="num" style="width:160px;">Debit</th>
          <th class="num" style="width:160px;">Credit</th>
          <th>Memo</th>
          <th style="width:90px;"></th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let line of lines; let i = index">
          <td>
            <select [(ngModel)]="line.accountId" [disabled]="isSubmitting || isLoadingAccounts" style="width:100%;">
              <option [ngValue]="null">-- Select account --</option>
              <option *ngFor="let a of accounts" [ngValue]="a.id">
                {{ a.accountCode }} - {{ a.name }} ({{ typeLabel(a.type) }})
              </option>
            </select>
          </td>

          <td class="num">
            <input
              type="number"
              step="0.01"
              style="width:140px;text-align:right;"
              [(ngModel)]="line.debit"
              (ngModelChange)="onDebitChange(line)"
              [disabled]="isSubmitting" />
          </td>

          <td class="num">
            <input
              type="number"
              step="0.01"
              style="width:140px;text-align:right;"
              [(ngModel)]="line.credit"
              (ngModelChange)="onCreditChange(line)"
              [disabled]="isSubmitting" />
          </td>

          <td>
            <input class="input-full" type="text" [(ngModel)]="line.memo" [disabled]="isSubmitting" />
          </td>

          <td class="num">
            <button class="btn btn-danger" (click)="removeLine(i)" [disabled]="isSubmitting || lines.length <= 2">
              Remove
            </button>
          </td>
        </tr>
      </tbody>

      <tfoot>
        <tr>
          <td class="num" style="font-weight:bold;">Totals:</td>
          <td class="num" style="font-weight:bold;">
            {{ totalDebit() | number:'1.2-2' }}
          </td>
          <td class="num" style="font-weight:bold;">
            {{ totalCredit() | number:'1.2-2' }}
          </td>
          <td colspan="2">
            <span *ngIf="isBalanced()" style="color:#16a34a;font-weight:bold;">Balanced</span>
            <span *ngIf="!isBalanced()" style="color:#b45309;font-weight:bold;">Not Balanced</span>
          </td>
        </tr>
      </tfoot>
    </table>

    <div class="row" style="align-items:center;margin-top:12px;">
      <button class="btn btn-secondary" (click)="addLine()" [disabled]="isSubmitting">
        Add Line
      </button>

      <button class="btn" (click)="submit()" [disabled]="isSubmitting || isLoadingAccounts || !isBalanced()">
        {{ isSubmitting ? 'Saving...' : 'Save Journal Entry' }}
      </button>

      <button class="btn btn-secondary" (click)="cancel()" [disabled]="isSubmitting">
        Cancel
      </button>
    </div>

    <p class="error" *ngIf="error">{{ error }}</p>
  </div>
</div>
